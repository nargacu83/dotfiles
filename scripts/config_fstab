#!/usr/bin/env bash

#
# DON'T USE THIS SCRIPT WITHOUT CHANGING fstab
#
# Modified script by Quentin Franchi, original script by mageas (https://gitlab.com/Mageas)
# Source : https://gitlab.com/Mageas/linux/-/blob/master/Mageas/install.sh
#

declare FSTAB=()

function config_fstab () {
    for disk in "${FSTAB[@]}"; do
        uuid=$(echo "$disk" | awk -F" -> " '{print $1}' | xargs)
        mount_point=$(echo "$disk" | awk -F" -> " '{print $2}' | xargs)
        fstype=$(echo "$disk" | awk -F" -> " '{print $3}' | xargs)

        # Create mount point
        if [ ! -d "$mount_point" ]; then
            mkdir $mount_point
        fi

        # Check if the given disk is already present in fstab
        if grep -q $uuid "/etc/fstab"; then
            print_inner_message "Skipping $uuid"
        else
            print_inner_message "UUID=$uuid    $mount_point    $fstype    defaults    0 0"
            # echo "" | sudo tee -a /etc/fstab
            # echo "# Generated from dotfiles" | sudo tee -a /etc/fstab
            # echo "$disk" | sudo tee -a /etc/fstab
        fi
    done
}

print_message "Configuring fstab"
config_fstab
